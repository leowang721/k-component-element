/*! @2015 Leo Wang. All Rights Reserved */
define("k-component/registry",["require","lodash","./cache","custom-element-shim","./config","etpl","promise"],function(require){function e(e){var t=e.template;if(!e.componentInited){if(u){var n=e.createShadowRoot(),r=document.importNode(t.content,!0);n.appendChild(r);var i=n.querySelector("content");if(!i)i=document.createElement("content"),n.appendChild(i);e.content=e}else{var o=document.createElement("fake-shadow-root");o.innerHTML=t.innerHTML,e.shadowRoot=o,e.appendChild(o);var i=o.querySelector("content");if(!i)i=document.createElement("content"),o.appendChild(i);e.content=i;for(var a=e.childNodes.length-1;a>=0;a--)if(1!==e.childNodes[a].nodeType||"fake-shadow-root"!==e.childNodes[a].tagName.toLowerCase())if(0===i.childNodes.length)i.appendChild(e.childNodes[a]);else i.insertBefore(e.childNodes[a],i.firstChild);else;}e.componentInited=!0}}function t(e,t){document.registerElement(e,{prototype:r.extend(Object.create(HTMLElement.prototype),t||{})})}function n(){var e="$$$__register_temp_container__$$$",t=document.getElementById(e);if(t)return t;else return t=document.createElement("div"),t.id=e,t.style.width=0,t.style.height=0,t.style.overflow="hidden",document.body.appendChild(t),t}var r=require("lodash"),i=require("./cache");require("custom-element-shim");var o=require("./config"),a=(require("etpl"),require("promise")),s={},u=!!document.body.createShadowRoot,c=function(e){return i._data(e,o.CACHED_ACTION_KEY)};s.createdCallback=function(){var n=this.getAttribute("name"),s=this.querySelector("template"),u=this.getAttribute("action");t(n,{template:s,actionPath:u,createdCallback:function(){this.setAttribute("k-component",!0);var t=this;e(t),t.promise=new a(function(e,n){if(t.actionPath)a.require([t.actionPath]).then(function(n){if(r.isArray(n))n=n[0];var a=new n({el:t});i._data(t,o.CACHED_ACTION_KEY,a),a.ready(function(){e()})}).catch(n);else e()})},attachedCallback:function(){},detachedCallback:function(){var e=this;e.promise&&e.promise.then(function(){c(e)&&c(e).dispose()})},attributeChangedCallback:function(e,t,n){var r=this;r.promise&&r.promise.then(function(){c(r)&&c(r).attributeChangedCallback(e,t,n)})}})},s.attachedCallback=function(){},t(o.REGISTER_TAG,s);var f={registerFromHTML:function(e){var t;t=n(),t.innerHTML=e}};return f});