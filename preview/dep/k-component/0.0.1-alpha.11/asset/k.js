/*! @2015 Leo Wang. All Rights Reserved */
define("k-component/k",["require","lodash","./lib/zepto","promise","./cache","./config"],function(require){function e(e,t){if("string"==typeof e){var n=i(e,t);if(u)n=i(r.toArray(n).concat(r.toArray(i("::shadow "+e,t))));return n}return i(e,t)}function t(e,t,n){for(var r,i=[],a=0,s=e.length;s>a;a++)if(r=e[a],r.promise)i.push(r.promise);if(i.length>0)o.all(i).then(t,n);else t()}function n(e){for(var t,n=this,i=r.toArray(arguments).slice(1),o=0,a=n.length;a>o;o++)t=c(n[o]),t[e].apply(t,i)}var r=require("lodash"),i=require("./lib/zepto"),o=require("promise"),a=require("./cache"),s=require("./config"),u=!!document.body.createShadowRoot,c=function(e){return a._data(e,s.CACHED_ACTION_KEY)},f=function(r,i){var a=e(r,i);return a.promise=new o(function(e,n){setTimeout(function(){t(a,e,n)},1)}),a.then=function(e,t){return a.promise.then(function(){n.call(a,"ready",e)})["catch"](function(){n.call(a,"ready",t)})},a["catch"]=function(e){return a.promise["catch"](function(){n.call(a,"ready",e)})},a.data=function(){var e=[].slice.call(arguments);return e.unshift("data"),a.promise.then(function(){n.apply(a,e)})["catch"](function(){a.data.apply(a,e)})},a};return f});