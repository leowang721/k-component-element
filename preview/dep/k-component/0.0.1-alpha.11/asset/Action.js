/*! @2015 Leo Wang. All Rights Reserved */
define("k-component/Action",["require","lodash","./k","./lib/util","promise","./cache","./preservedAttributes","etpl"],function(require){function e(e){var t=this;e=e||{},t.el=t.$(e.el),t.el.attr("k-component",""),t.el.attr("data-guid",r.guid()),t.on=t.el.on,t.one=t.el.one,t.off=t.el.off,t.trigger=t.el.trigger,t.triggerHandler=t.el.triggerHandler,t.content=t.$(e.el.content),t.shadowRoot=t.$(e.el.shadowRoot),t.data=o.curry(t.el),t.initialize();var n=t.content.html();t.renderer=require("etpl").compile(n),t.promise=new i(function(e){t.initBehavior(),t.bindEvents(),e()})}var t=require("lodash"),n=require("./k"),r=require("./lib/util"),i=require("promise"),o=require("./cache"),s=require("./preservedAttributes");return e.prototype={constructor:e,$:function(e){return n(e,this.el)},initialize:t.noop,getRenderingData:function(){var e=this.data,t=function(t){for(var n=t.replace(/\[(\d+)\]/g,".$1").split("."),r=n.shift(),i=e.get(r);i&&(r=n.shift());)i=i[r];return i};return{get:t,relatedModel:e}},render:function(){this.content.html(this.renderer(this.getRenderingData()))},ready:function(e){this.promise.then(t.bind(e,this))},attributes:{},getAttributes:function(){return this.attributes||{}},setAttributes:function(e){this.attributes=e},attributeChangedCallback:function(e,n,r){if(!this.get("disposed")){if(s[e])return void s[e].call(this,r,n);var i=this.getAttributes();if(i&&"function"==typeof i[e]&&n!==r)i[e].call(this,r,n);if(/^data\-/.test(e)&&n!==r){var o=t.camelCase(e.replace(/^data\-/g,""));this.data.set(o,r)}}},initBehavior:t.noop,bindEvents:t.noop,getParent:function(){for(var e=this.el;e!==document.body;){if(e=e.parentNode||e.host,!e)return;if(e["k-component"])return n.get(e)}},processError:function(e){r.processError(e)},get:function(e){return this[e]},set:function(e,t){this[e]=t},dispose:function(){this.data=null,this.set("disposed",!0)}},e});