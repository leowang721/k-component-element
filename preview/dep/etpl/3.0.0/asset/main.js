/*! @2015 Leo Wang. All Rights Reserved */
!function(e){function t(e,t){for(var n in t)if(t.hasOwnProperty(n))e[n]=t[n];return e}function n(){this.raw=[],this.length=0}function r(){return"___"+R++}function i(e,t){var n=new Function;n.prototype=t.prototype,e.prototype=new n,e.prototype.constructor=e}function o(e){return N[e]}function s(e){return'"'+e.replace(/\x5C/g,"\\\\").replace(/"/g,'\\"').replace(/\x0A/g,"\\n").replace(/\x09/g,"\\t").replace(/\x0D/g,"\\r")+'"'}function a(e){return e.replace(/[\^\[\]\$\(\)\{\}\?\*\.\+]/g,function(e){return"\\"+e})}function u(e){var t=arguments;return e.replace(/\{([0-9]+)\}/g,function(e,n){return t[n-0+1]})}function c(e){return e=e.replace(/^\s*\*/,""),u('gv({0},["{1}"])',s(e),e.replace(/\[['"]?([^'"]+)['"]?\]/g,function(e,t){return"."+t}).split(".").join('","'))}function f(e,t,n,r,i,o){for(var s=n.length,a=e.split(t),u=0,c=[],f=0,l=a.length;l>f;f++){var p=a[f];if(f){var h=1;for(u++;;){var d=p.indexOf(n);if(0>d){c.push(u>1&&h?t:"",p);break}if(u=r?u-1:0,c.push(u>0&&h?t:"",p.slice(0,d),u>0?n:""),p=p.slice(d+s),h=0,0===u)break}if(0===u)i(c.join("")),o(p),c=[]}else p&&o(p)}if(u>0&&c.length>0)o(t),o(c.join(""))}function l(e,t,n){var r,i=[],o=t.options,a="",u="",p="",h="";if(n)a="ts(",u=")",p=P,h=$,r=o.defaultFilter;return f(e,o.variableOpen,o.variableClose,1,function(e){if(n&&e.indexOf("|")<0&&r)e+="|"+r;var o=e.indexOf("|"),s=(o>0?e.slice(0,o):e).replace(/^\s+/,"").replace(/\s+$/,""),f=o>0?e.slice(o+1):"",d=0===s.indexOf("*"),v=[d?"":a,c(s),d?"":u];if(f){f=l(f,t);for(var g=f.split("|"),m=0,y=g.length;y>m;m++){var E=g[m];if(/^\s*([a-z0-9_-]+)(\((.*)\))?\s*$/i.test(E)){if(v.unshift('fs["'+RegExp.$1+'"]('),RegExp.$3)v.push(",",RegExp.$3);v.push(")")}}}i.push(p,v.join(""),h)},function(e){i.push(p,n?s(e):e,h)}),i.join("")}function p(e,t){this.value=e,this.engine=t}function h(e,t){this.value=e,this.engine=t,this.children=[],this.cloneProps=[]}function d(e,t){var n=e.stack,r=t?n.find(function(e){return e instanceof t}):n.bottom();if(r){for(var i;(i=n.top())!==r;){if(!i.autoClose)throw new Error(i.type+" must be closed manually: "+i.value);i.autoClose(e)}r.close(e)}return r}function v(e,t){if(!/^\s*([a-z0-9\/_-]+)\s*(\(\s*master\s*=\s*([a-z0-9\/_-]+)\s*\))?\s*/i.test(e))throw new Error("Invalid "+this.type+" syntax: "+e);this.master=RegExp.$3,this.name=RegExp.$1,h.call(this,e,t),this.blocks={}}function g(e,t){if(!/^\s*([a-z0-9\/_-]+)\s*$/i.test(e))throw new Error("Invalid "+this.type+" syntax: "+e);this.name=RegExp.$1,h.call(this,e,t),this.cloneProps=["name"]}function m(e,t){if(!/^\s*([a-z0-9\/_-]+)\s*$/i.test(e))throw new Error("Invalid "+this.type+" syntax: "+e);this.name=RegExp.$1,h.call(this,e,t),this.cloneProps=["name","state","blocks"],this.blocks={}}function y(e,t){if(!/^\s*([a-z0-9_]+)\s*=([\s\S]*)$/i.test(e))throw new Error("Invalid "+this.type+" syntax: "+e);this.name=RegExp.$1,this.expr=RegExp.$2,h.call(this,e,t),this.cloneProps=["name","expr"]}function E(e,t){if(!/^\s*([a-z0-9_-]+)\s*(\(([\s\S]*)\))?\s*$/i.test(e))throw new Error("Invalid "+this.type+" syntax: "+e);this.name=RegExp.$1,this.args=RegExp.$3,h.call(this,e,t),this.cloneProps=["name","args"]}function w(e,t){if(!/^\s*([a-z0-9\/_-]+)\s*(\(([\s\S]*)\))?\s*$/i.test(e))throw new Error("Invalid "+this.type+" syntax: "+e);this.name=RegExp.$1,this.args=RegExp.$3,h.call(this,e,t),this.cloneProps=["name","args"]}function b(e,t){var n=new RegExp(u("^\\s*({0}[\\s\\S]+{1})\\s+as\\s+{0}([0-9a-z_]+){1}\\s*(,\\s*{0}([0-9a-z_]+){1})?\\s*$",a(t.options.variableOpen),a(t.options.variableClose)),"i");if(!n.test(e))throw new Error("Invalid "+this.type+" syntax: "+e);this.list=RegExp.$1,this.item=RegExp.$2,this.index=RegExp.$4,h.call(this,e,t),this.cloneProps=["list","item","index"]}function x(e,t){h.call(this,e,t)}function A(e,t){x.call(this,e,t)}function C(e,t){h.call(this,e,t)}function O(e,t){t.target=e;var n=t.engine,r=e.name;if(n.targets[r])switch(n.options.namingConflict){case"override":n.targets[r]=e,t.targets.push(r);case"ignore":break;default:throw new Error("Target exists: "+r)}else n.targets[r]=e,t.targets.push(r)}function T(e,t){D[e]=t,t.prototype.type=e}function S(e){this.options={commandOpen:"<!--",commandClose:"-->",commandSyntax:/^\s*(\/)?([a-z]+)\s*(?::([\s\S]*))?$/,variableOpen:"${",variableClose:"}",defaultFilter:"html"},this.config(e),this.targets={},this.filters=t({},M)}function _(e,t){function r(){var e;if(l.length>0&&(e=l.join(""))){var n=new p(e,t);if(n.beforeAdd(c),u.top().addChild(n),l=[],t.options.strip&&c.current instanceof h)n.value=e.replace(/^[\x20\t\r]*\n/,"");c.current=n}}var i,o=t.options.commandOpen,s=t.options.commandClose,a=t.options.commandSyntax,u=new n,c={engine:t,targets:[],stack:u,target:null},l=[];return f(e,o,s,0,function(e){var n=a.exec(e);if(n&&(i=D[n[2].toLowerCase()])&&"function"==typeof i){r();var u=c.current;if(t.options.strip&&u instanceof p)u.value=u.value.replace(/\r?\n[\x20\t]*$/,"\n");if(n[1])u=d(c,i);else{if(u=new i(n[3],t),"function"==typeof u.beforeOpen)u.beforeOpen(c);u.open(c)}c.current=u}else if(!/^\s*\/\//.test(e))l.push(o,e,s);i=null},function(e){l.push(e)}),r(),d(c),c.targets}n.prototype={push:function(e){this.raw[this.length++]=e},pop:function(){if(this.length>0){var e=this.raw[--this.length];return this.raw.length=this.length,e}},top:function(){return this.raw[this.length-1]},bottom:function(){return this.raw[0]},find:function(e){for(var t=this.length;t--;){var n=this.raw[t];if(e(n))return n}}};var R=178245,N={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},M={html:function(e){return e.replace(/[&<>"']/g,o)},url:encodeURIComponent,raw:function(e){return e}},L='var r="";',P="r+=",$=";",I="return r;";if("undefined"!=typeof navigator&&/msie\s*([0-9]+)/i.test(navigator.userAgent)&&RegExp.$1-0<8)L="var r=[],ri=0;",P="r[ri++]=",I='return r.join("");';p.prototype={getRendererBody:function(){var e=this.value,t=this.engine.options;if(!e||t.strip&&/^\s*$/.test(e))return"";else return l(e,this.engine,1)},clone:function(){return this}},h.prototype={addChild:function(e){this.children.push(e)},open:function(e){var t=e.stack.top();t&&t.addChild(this),e.stack.push(this)},close:function(e){if(e.stack.top()===this)e.stack.pop()},getRendererBody:function(){for(var e=[],t=this.children,n=0;n<t.length;n++)e.push(t[n].getRendererBody());return e.join("")},clone:function(){for(var e=new this.constructor(this.value,this.engine),t=0,n=this.children.length;n>t;t++)e.addChild(this.children[t].clone());for(var t=0,n=this.cloneProps.length;n>t;t++){var r=this.cloneProps[t];e[r]=this[r]}return e}};var j='data=data||{};var v={},fs=engine.filters,hg=typeof data.get=="function",gv=function(n,ps){var p=ps[0],d=v[p];if(d==null){if(hg){return data.get(n);}d=data[p];}for(var i=1,l=ps.length;i<l;i++)if(d!=null)d = d[ps[i]];return d;},ts=function(s){if(typeof s==="string"){return s;}if(s==null){s="";}return ""+s;};';i(v,h),i(g,h),i(m,h),i(y,h),i(E,h),i(w,h),i(b,h),i(x,h),i(A,x),i(C,x);var k={READING:1,READED:2,APPLIED:3,READY:4};m.prototype.applyMaster=v.prototype.applyMaster=function(e){function t(e){var r=e.children;if(r instanceof Array)for(var i=0,o=r.length;o>i;i++){var s=r[i];if(s instanceof g&&n[s.name])s=r[i]=n[s.name];t(s)}}if(this.state>=k.APPLIED)return 1;var n=this.blocks,r=this.engine.targets[e];if(r&&r.applyMaster(r.master))return this.children=r.clone().children,t(this),this.state=k.APPLIED,1;else return void 0},v.prototype.isReady=function(){function e(r){for(var i=0,o=r.children.length;o>i;i++){var s=r.children[i];if(s instanceof m){var a=t.targets[s.name];n=n&&a&&a.isReady(t)}else if(s instanceof h)e(s)}}if(this.state>=k.READY)return 1;var t=this.engine,n=1;if(this.applyMaster(this.master))return e(this),n&&(this.state=k.READY),n;else return void 0},v.prototype.getRenderer=function(){if(this.renderer)return this.renderer;if(this.isReady()){var e=new Function("data","engine",[j,L,this.getRendererBody(),I].join("\n")),t=this.engine;return this.renderer=function(n){return e(n,t)},this.renderer}return null},v.prototype.open=function(e){d(e),h.prototype.open.call(this,e),this.state=k.READING,O(this,e)},y.prototype.open=w.prototype.open=function(e){e.stack.top().addChild(this)},g.prototype.open=function(e){h.prototype.open.call(this,e),(e.imp||e.target).blocks[this.name]=this},A.prototype.open=function(e){var t=new C;t.open(e);var n=d(e,x);n.addChild(this),e.stack.push(this)},C.prototype.open=function(e){var t=d(e,x);t.addChild(this),e.stack.push(this)},m.prototype.open=function(e){this.parent=e.stack.top(),this.target=e.target,h.prototype.open.call(this,e),this.state=k.READING,e.imp=this},w.prototype.close=y.prototype.close=function(){},m.prototype.close=function(e){h.prototype.close.call(this,e),this.state=k.READED,e.imp=null},v.prototype.close=function(e){h.prototype.close.call(this,e),this.state=this.master?k.READED:k.APPLIED,e.target=null},m.prototype.autoClose=function(e){var t=this.parent.children;t.push.apply(t,this.children),this.children.length=0;for(var n in this.blocks)this.target.blocks[n]=this.blocks[n];this.blocks={},this.close(e)},w.prototype.beforeOpen=m.prototype.beforeOpen=y.prototype.beforeOpen=b.prototype.beforeOpen=E.prototype.beforeOpen=g.prototype.beforeOpen=x.prototype.beforeOpen=p.prototype.beforeAdd=function(e){if(!e.stack.bottom()){var t=new v(r(),e.engine);t.open(e)}},m.prototype.getRendererBody=function(){return this.applyMaster(this.name),h.prototype.getRendererBody.call(this)},w.prototype.getRendererBody=function(){return u("{0}engine.render({2},{{3}}){1}",P,$,s(this.name),l(this.args,this.engine).replace(/(^|,)\s*([a-z0-9_]+)\s*=/gi,function(e,t,n){return(t||"")+s(n)+":"}))},y.prototype.getRendererBody=function(){if(this.expr)return u("v[{0}]={1};",s(this.name),l(this.expr,this.engine));else return""},x.prototype.getRendererBody=function(){return u("if({0}){{1}}",l(this.value,this.engine),h.prototype.getRendererBody.call(this))},C.prototype.getRendererBody=function(){return u("}else{{0}",h.prototype.getRendererBody.call(this))},b.prototype.getRendererBody=function(){return u('var {0}={1};if({0} instanceof Array)for (var {4}=0,{5}={0}.length;{4}<{5};{4}++){v[{2}]={4};v[{3}]={0}[{4}];{6}}else if(typeof {0}==="object")for(var {4} in {0}){v[{2}]={4};v[{3}]={0}[{4}];{6}}',r(),l(this.list,this.engine),s(this.index||r()),s(this.item),r(),r(),h.prototype.getRendererBody.call(this))},E.prototype.getRendererBody=function(){var e=this.args;return u("{2}fs[{5}]((function(){{0}{4}{1}})(){6}){3}",L,I,P,$,h.prototype.getRendererBody.call(this),s(this.name),e?","+l(e,this.engine):"")};var D={};T("target",v),T("block",g),T("import",m),T("use",w),T("var",y),T("for",b),T("if",x),T("elif",A),T("else",C),T("filter",E),S.prototype.config=function(e){t(this.options,e)},S.prototype.compile=S.prototype.parse=function(e){if(e){var t=_(e,this);if(t.length)return this.targets[t[0]].getRenderer()}return new Function('return ""')},S.prototype.getRenderer=function(e){var t=this.targets[e];if(t)return t.getRenderer();else return void 0},S.prototype.render=function(e,t){var n=this.getRenderer(e);if(n)return n(t);else return""},S.prototype.addFilter=function(e,t){if("function"==typeof t)this.filters[e]=t};var q=new S;if(q.Engine=S,"object"==typeof exports&&"object"==typeof module)exports=module.exports=q;else if("function"==typeof define&&define.amd)define("etpl/main",[],q);else e.etpl=q}(this),define("etpl",["etpl/main"],function(e){return e});