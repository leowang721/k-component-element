/*! @2015 Leo Wang. All Rights Reserved */
define("fc-storage/util",["require","underscore"],function(require){function e(e){return Object.prototype.toString.call(e)}function t(e,t){for(var n in t)if(t.hasOwnProperty(n))e[n]=t[n];return e}var n=require("underscore"),r={getExtendedStorageMethods:function(r){var i={getItem:function(e){var t=null;try{t=JSON.parse(r.getItem(e))}catch(n){}return t},setItem:function(e,t){if("string"!=typeof e||!e)throw new Error("错误的storage.setItem使用，非法键值");return r.setItem(e,JSON.stringify(t)),this.fire("change"),r},updateItem:function(n,r){if("string"!=typeof n||!n)throw new Error("错误的storage.updateItem使用，非法键值");var i=this.getItem(n);if(e(i)!==e(r))return this.setItem(n,r),this.fire("change"),r;if($.isPlainObject(r))this.setItem(n,t(i,r));else this.setItem(n,r);return this.fire("change"),this.getItem(n)},fill:function(e,t){if(!n.isObject(e)||n.isArray(e))throw new Error("错误的storage.memory.fill使用，非法值");t=t||{};var i=t.update?r.updateItem:r.setItem;for(var o in e)if(e.hasOwnProperty(o))i.call(r,o,e[o]);return this.fire("change"),r},removeItem:function(e){r.removeItem(e),this.fire("change")},clear:function(){r.clear(),this.fire("change")}};return i.get=i.getItem,i.set=i.setItem,i.update=i.updateItem,i.remove=i.removeItem,i}};return r});