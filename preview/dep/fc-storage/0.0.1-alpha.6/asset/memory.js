/*! @2015 Leo Wang. All Rights Reserved */
define("fc-storage/memory",["require","underscore","eoo","mini-event/EventTarget"],function(require){"use strict";function e(e){return Object.prototype.toString.call(e)}var t=require("underscore"),n=require("eoo"),r=require("mini-event/EventTarget"),i={};i.constructor=function(){var n={};this.supported=!0,this.get=this.getItem=function(e){return n[e]},this.set=this.setItem=function(e,t){if("string"!=typeof e||!e)throw new Error("错误的storage.memory.setItem使用，非法键值");return n[e]=t,this.fire("change"),this},this.update=this.updateItem=function(n,r){if("string"!=typeof n||!n)throw new Error("错误的storage.memory.updateItem使用，非法键值");var i=this.getItem(n);if(e(i)!==e(r))return this.setItem(n,r),this.fire("change"),r;if(t.isArray(r)||t.isObject(r))this.setItem(n,t.deepExtend(i,r));else this.setItem(n,r);return this.fire("change"),r},this.fill=function(e,r){if(!t.isObject(e)||t.isArray(e))throw new Error("错误的storage.memory.fill使用，非法值");if(r=r||{},r.update)t.deepExtend(n,e);else t.extend(n,e);return this.fire("change"),this},this.remove=this.removeItem=function(e){return delete n[e],this.fire("change"),this},this.clear=function(){return n={},this.fire("change"),this},this.dump=function(){return t.deepClone(n)}};var o=n.create(r,i),s=new o;return s.createInstance=function(){return new o},s});